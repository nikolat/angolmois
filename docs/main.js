/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function r(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function o(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}e.r(t),e.d(t,{OG:()=>U,My:()=>A,Ph:()=>C,lX:()=>k,Id:()=>N,fg:()=>$,qj:()=>L,aT:()=>S,lq:()=>T,z:()=>O,Q5:()=>q});const i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,s=e=>e instanceof Uint8Array,c=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),a=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function u(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!s(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class l{clone(){return this._cloneInto()}}function d(e){const t=t=>e().update(u(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function f(e=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class h extends l{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=c(this.buffer)}update(e){o(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=u(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=c(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){o(this),function(e,t){r(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>i-a&&(this.process(n,0),a=0);for(let e=a;e<i;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+u,c,r)}(n,i-8,BigInt(8*this.length),s),this.process(n,0);const u=c(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,f=this.get();if(d>f.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)u.setUint32(4*e,f[e],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const p=(e,t,n)=>e&t^e&n^t&n,y=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),g=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),w=new Uint32Array(64);class m extends h{constructor(){super(64,32,8,!1),this.A=0|g[0],this.B=0|g[1],this.C=0|g[2],this.D=0|g[3],this.E=0|g[4],this.F=0|g[5],this.G=0|g[6],this.H=0|g[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:c}=this;return[e,t,n,r,o,i,s,c]}set(e,t,n,r,o,i,s,c){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|c}process(e,t){for(let n=0;n<16;n++,t+=4)w[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=w[e-15],n=w[e-2],r=a(t,7)^a(t,18)^t>>>3,o=a(n,17)^a(n,19)^n>>>10;w[e]=o+w[e-7]+r+w[e-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:c,G:u,H:l}=this;for(let e=0;e<64;e++){const t=l+(a(s,6)^a(s,11)^a(s,25))+((d=s)&c^~d&u)+y[e]+w[e]|0,f=(a(n,2)^a(n,13)^a(n,22))+p(n,r,o)|0;l=u,u=c,c=s,s=i+t|0,i=o,o=r,r=n,n=t+f|0}var d;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,i,s,c,u,l)}roundClean(){w.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const b=d((()=>new m)),E=(BigInt(0),BigInt(1)),v=BigInt(2),x=e=>e instanceof Uint8Array,B=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function A(e){if(!x(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=B[e[n]];return t}function I(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function S(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,o=e.slice(r,r+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[t]=i}return n}function C(e){return I(A(e))}function k(e){if(!x(e))throw new Error("Uint8Array expected");return I(A(Uint8Array.from(e).reverse()))}function T(e,t){return S(e.toString(16).padStart(2*t,"0"))}function O(e,t){return T(e,t).reverse()}function L(e,t,n){let r;if("string"==typeof t)try{r=S(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!x(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function N(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!x(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const U=e=>(v<<BigInt(e-1))-E,R=e=>new Uint8Array(e),P=e=>Uint8Array.from(e);function $(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=R(e),o=R(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...e)=>n(o,r,...e),a=(e=R())=>{o=c(P([0]),e),r=c(),0!==e.length&&(o=c(P([1]),e),r=c())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=c();const t=r.slice();n.push(t),e+=r.length}return N(...n)};return(e,t)=>{let n;for(s(),a(e);!(n=t(u()));)a();return s(),n}}const H={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function q(e,t,n={}){const r=(t,n,r)=>{const o=H[n];if("function"!=typeof o)throw new Error(`Invalid validator "${n}", expected function`);const i=e[t];if(!(r&&void 0===i||o(i,e)))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const j=BigInt(0),_=BigInt(1),M=BigInt(2),F=BigInt(3),V=BigInt(4),D=BigInt(5),K=BigInt(8);function z(e,t){const n=e%t;return n>=j?n:t+n}function W(e,t,n){if(n<=j||t<j)throw new Error("Expected power/modulo > 0");if(n===_)return j;let r=_;for(;t>j;)t&_&&(r=r*e%n),e=e*e%n,t>>=_;return r}function Z(e,t,n){let r=e;for(;t-- >j;)r*=r,r%=n;return r}function G(e,t){if(e===j||t<=j)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=z(e,t),r=t,o=j,i=_,s=_,c=j;for(;n!==j;){const e=r/n,t=r%n,a=o-s*e,u=i-c*e;r=n,n=t,o=s,i=c,s=a,c=u}if(r!==_)throw new Error("invert: does not exist");return z(o,t)}BigInt(9),BigInt(16);const Y=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function J(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Q(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function X(e){const t=Q(e);return t+Math.ceil(t/2)}class ee extends l{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");n(e.outputLen),n(e.blockLen)}(e);const r=u(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return o(this),this.iHash.update(e),this}digestInto(e){o(this),r(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const te=(e,t,n)=>new ee(e,t).update(n).digest();te.create=(e,t)=>new ee(e,t);const ne=BigInt(0),re=BigInt(1);function oe(e){return q(e.Fp,Y.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),q(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...J(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:ie,aT:se}=t,ce={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=ce;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:ie(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=ce,n="string"==typeof e?se(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=ce._parseInt(n.subarray(2)),{d:s,l:c}=ce._parseInt(i);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},ae=BigInt(0),ue=BigInt(1),le=(BigInt(2),BigInt(3));function de(e){const t=function(e){const t=oe(e);return q(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(e){return z(e,r)}function c(e){return G(e,r)}const{ProjectivePoint:a,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:d}=function(e){const t=function(e){const t=oe(e);q(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const o=t.toAffine();return N(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function i(e){const{a:r,b:o}=t,i=n.sqr(e),s=n.mul(i,e);return n.add(n.add(s,n.mul(e,r)),o)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&ae<e&&e<t.n}function c(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=A(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:C(L("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=z(s,i)),c(s),s}const u=new Map;function l(e){if(!(e instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof d)throw new Error("projective point not allowed");const o=e=>n.eql(e,n.ZERO);return o(t)&&o(r)?d.ZERO:new d(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(d.fromAffine)}static fromHex(e){const t=d.fromAffine(o(L("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return d.BASE.multiply(a(e))}_setWindowSize(e){this._WINDOW_SIZE=e,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),s=i(e);if(!n.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:r,pz:o}=this,{px:i,py:s,pz:c}=e,a=n.eql(n.mul(t,c),n.mul(i,o)),u=n.eql(n.mul(r,c),n.mul(s,o));return a&&u}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,o=n.mul(r,le),{px:i,py:s,pz:c}=this;let a=n.ZERO,u=n.ZERO,l=n.ZERO,f=n.mul(i,i),h=n.mul(s,s),p=n.mul(c,c),y=n.mul(i,s);return y=n.add(y,y),l=n.mul(i,c),l=n.add(l,l),a=n.mul(e,l),u=n.mul(o,p),u=n.add(a,u),a=n.sub(h,u),u=n.add(h,u),u=n.mul(a,u),a=n.mul(y,a),l=n.mul(o,l),p=n.mul(e,p),y=n.sub(f,p),y=n.mul(e,y),y=n.add(y,l),l=n.add(f,f),f=n.add(l,f),f=n.add(f,p),f=n.mul(f,y),u=n.add(u,f),p=n.mul(s,c),p=n.add(p,p),f=n.mul(p,y),a=n.sub(a,f),l=n.mul(p,h),l=n.add(l,l),l=n.add(l,l),new d(a,u,l)}add(e){l(e);const{px:r,py:o,pz:i}=this,{px:s,py:c,pz:a}=e;let u=n.ZERO,f=n.ZERO,h=n.ZERO;const p=t.a,y=n.mul(t.b,le);let g=n.mul(r,s),w=n.mul(o,c),m=n.mul(i,a),b=n.add(r,o),E=n.add(s,c);b=n.mul(b,E),E=n.add(g,w),b=n.sub(b,E),E=n.add(r,i);let v=n.add(s,a);return E=n.mul(E,v),v=n.add(g,m),E=n.sub(E,v),v=n.add(o,i),u=n.add(c,a),v=n.mul(v,u),u=n.add(w,m),v=n.sub(v,u),h=n.mul(p,E),u=n.mul(y,m),h=n.add(u,h),u=n.sub(w,h),h=n.add(w,h),f=n.mul(u,h),w=n.add(g,g),w=n.add(w,g),m=n.mul(p,m),E=n.mul(y,E),w=n.add(w,m),m=n.sub(g,m),m=n.mul(p,m),E=n.add(E,m),g=n.mul(w,E),f=n.add(f,g),g=n.mul(v,E),u=n.mul(b,u),u=n.sub(u,g),g=n.mul(b,w),h=n.mul(v,h),h=n.add(h,g),new d(u,f,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(d.ZERO)}wNAF(e){return h.wNAFCached(this,u,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(d.fromAffine)}))}multiplyUnsafe(e){const r=d.ZERO;if(e===ae)return r;if(c(e),e===ue)return this;const{endo:o}=t;if(!o)return h.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:a,k2:u}=o.splitScalar(e),l=r,f=r,p=this;for(;s>ae||u>ae;)s&ue&&(l=l.add(p)),u&ue&&(f=f.add(p)),p=p.double(),s>>=ue,u>>=ue;return i&&(l=l.negate()),a&&(f=f.negate()),f=new d(n.mul(f.px,o.beta),f.py,f.pz),l.add(f)}multiply(e){c(e);let r,o,i=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:c,k2:a}=s.splitScalar(i);let{p:u,f:l}=this.wNAF(t),{p:f,f:p}=this.wNAF(a);u=h.constTimeNegate(e,u),f=h.constTimeNegate(c,f),f=new d(n.mul(f.px,s.beta),f.py,f.pz),r=u.add(f),o=l.add(p)}else{const{p:e,f:t}=this.wNAF(i);r=e,o=t}return d.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(e,t,n){const r=d.BASE,o=(e,t)=>t!==ae&&t!==ue&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,n));return i.is0()?void 0:i}toAffine(e){const{px:t,py:r,pz:o}=this,i=this.is0();null==e&&(e=i?n.ONE:n.inv(o));const s=n.mul(t,e),c=n.mul(r,e),a=n.mul(o,e);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(a,n.ONE))throw new Error("invZ was invalid");return{x:s,y:c}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===ue)return!0;if(n)return n(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===ue?this:n?n(d,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(d,this,e)}toHex(e=!0){return A(this.toRawBytes(e))}}d.BASE=new d(t.Gx,t.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=t.nBitLength,h=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,o=t;for(;n>ne;)n&re&&(r=r.add(o)),o=o.double(),n>>=re;return r},precomputeWindow(e,t){const{windows:n,windowSize:o}=r(t),i=[];let s=e,c=s;for(let e=0;e<n;e++){c=s,i.push(c);for(let e=1;e<o;e++)c=c.add(s),i.push(c);s=c.double()}return i},wNAF(t,o,i){const{windows:s,windowSize:c}=r(t);let a=e.ZERO,u=e.BASE;const l=BigInt(2**t-1),d=2**t,f=BigInt(t);for(let e=0;e<s;e++){const t=e*c;let r=Number(i&l);i>>=f,r>c&&(r-=d,i+=re);const s=t,h=t+Math.abs(r)-1,p=e%2!=0,y=r<0;0===r?u=u.add(n(p,o[s])):a=a.add(n(y,o[h]))}return{p:a,f:u}},wNAFCached(e,t,n,r){const o=e._WINDOW_SIZE||1;let i=t.get(e);return i||(i=this.precomputeWindow(e,o),1!==o&&t.set(e,r(i))),this.wNAF(o,i,n)}}}(d,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}({...t,toBytes(e,t,r){const o=t.toAffine(),i=n.toBytes(o.x),s=N;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==o||2!==r&&3!==r){if(t===i&&4===r)return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=C(s);if(!(ae<(c=e)&&c<n.ORDER))throw new Error("Point is not on curve");const t=l(e);let o=n.sqrt(t);return!(1&~r)!=((o&ue)===ue)&&(o=n.neg(o)),{x:e,y:o}}var c}}),f=e=>A(T(e,t.nByteLength));function h(e){return e>r>>ue}const p=(e,t,n)=>C(e.slice(t,n));class y{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=L("compactSignature",e,2*n),new y(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=ce.toSig(L("DER",e));return new y(t,n)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){const{r,s:o,recovery:i}=this,u=b(L("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const l=2===i||3===i?r+t.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const d=1&i?"03":"02",h=a.fromHex(d+f(l)),p=c(l),y=s(-u*p),g=s(o*p),w=a.BASE.multiplyAndAddUnsafe(h,y,g);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return S(this.toDERHex())}toDERHex(){return ce.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return S(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const g={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const e=X(t.n);return function(e,t,n=!1){const r=e.length,o=Q(t),i=X(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=z(n?C(e):k(e),t-_)+_;return n?O(s,o):T(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=a.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===o||r===i:n?r===2*o||r===2*i:e instanceof a}const m=t.bits2int||function(e){const n=C(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(m(e))},E=U(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(ae<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return T(e,t.nByteLength)}const x={lowS:t.lowS,prehash:!1},B={lowS:t.lowS,prehash:!1};return a.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return a.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return a.fromHex(t).multiply(u(e)).toRawBytes(n)},sign:function(e,r,o=x){const{seed:i,k2sig:l}=function(e,r,o=x){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:l}=t;let{lowS:f,prehash:p,extraEntropy:g}=o;null==f&&(f=!0),e=L("msgHash",e),p&&(e=L("prehashed msgHash",i(e)));const w=b(e),E=u(r),B=[v(E),v(w)];if(null!=g){const e=!0===g?l(n.BYTES):g;B.push(L("extraEntropy",e))}const A=N(...B),I=w;return{seed:A,k2sig:function(e){const t=m(e);if(!d(t))return;const n=c(t),r=a.BASE.multiply(t).toAffine(),o=s(r.x);if(o===ae)return;const i=s(n*s(I+o*E));if(i===ae)return;let u=(r.x===o?0:2)|Number(r.y&ue),l=i;return f&&h(i)&&(l=function(e){return h(e)?s(-e):e}(i),u^=1),new y(o,l,u)}}}(e,r,o),f=t;return $(f.hash.outputLen,f.nByteLength,f.hmac)(i,l)},verify:function(e,n,r,o=B){const i=e;if(n=L("msgHash",n),r=L("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:l}=o;let d,f;try{if("string"==typeof i||i instanceof Uint8Array)try{d=y.fromDER(i)}catch(e){if(!(e instanceof ce.Err))throw e;d=y.fromCompact(i)}else{if("object"!=typeof i||"bigint"!=typeof i.r||"bigint"!=typeof i.s)throw new Error("PARSE");{const{r:e,s:t}=i;d=new y(e,t)}}f=a.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;l&&(n=t.hash(n));const{r:h,s:p}=d,g=b(n),w=c(p),m=s(g*w),E=s(h*w),v=a.BASE.multiplyAndAddUnsafe(f,m,E)?.toAffine();return!!v&&s(v.x)===h},ProjectivePoint:a,Signature:y,utils:g}}function fe(e){return{hash:e,hmac:(t,...n)=>te(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!s(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:f}}BigInt(4);const he=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),pe=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ye=BigInt(1),ge=BigInt(2),we=(e,t)=>(e+t/ge)/t;function me(e){const t=he,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),u=e*e*e%t,l=u*u*e%t,d=Z(l,n,t)*l%t,f=Z(d,n,t)*l%t,h=Z(f,ge,t)*u%t,p=Z(h,o,t)*h%t,y=Z(p,i,t)*p%t,g=Z(y,c,t)*y%t,w=Z(g,a,t)*g%t,m=Z(w,c,t)*y%t,b=Z(m,n,t)*l%t,E=Z(b,s,t)*p%t,v=Z(E,r,t)*u%t,x=Z(v,ge,t);if(!be.eql(be.sqr(x),e))throw new Error("Cannot find square root");return x}const be=function(e,t,n=!1,r={}){if(e<=j)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=J(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=function(e){if(e%V===F){const t=(e+_)/V;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%K===D){const t=(e-D)/K;return function(e,n){const r=e.mul(n,M),o=e.pow(r,t),i=e.mul(n,o),s=e.mul(e.mul(i,M),o),c=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(c),n))throw new Error("Cannot find square root");return c}}return function(e){const t=(e-_)/M;let n,r,o;for(n=e-_,r=0;n%M===j;n/=M,r++);for(o=M;o<e&&W(o,t,e)!==e-_;o++);if(1===r){const t=(e+_)/V;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+_)/M;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let c=r,a=e.pow(e.mul(e.ONE,o),n),u=e.pow(s,i),l=e.pow(s,n);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(l);t<c&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(a,_<<BigInt(c-t-1));a=e.sqr(n),u=e.mul(u,n),l=e.mul(l,a),c=t}return u}}(e)}(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:U(o),ZERO:j,ONE:_,create:t=>z(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return j<=t&&t<e},is0:e=>e===j,isOdd:e=>(e&_)===_,neg:t=>z(-t,e),eql:(e,t)=>e===t,sqr:t=>z(t*t,e),add:(t,n)=>z(t+n,e),sub:(t,n)=>z(t-n,e),mul:(t,n)=>z(t*n,e),pow:(e,t)=>function(e,t,n){if(n<j)throw new Error("Expected power > 0");if(n===j)return e.ONE;if(n===_)return t;let r=e.ONE,o=t;for(;n>j;)n&_&&(r=e.mul(r,o)),o=e.sqr(o),n>>=_;return r}(c,e,t),div:(t,n)=>z(t*G(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>G(t,e),sqrt:r.sqrt||(e=>s(c,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),o=e.inv(r);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),o),n}(c,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?O(e,i):T(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return n?k(e):C(e)}});return Object.freeze(c)}(he,void 0,void 0,{sqrt:me}),Ee=function(e,t){const n=t=>de({...e,...fe(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:be,n:pe,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=pe,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-ye*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=we(i*e,t),a=we(-r*e,t);let u=z(e-c*n-a*o,t),l=z(-c*r-a*i,t);const d=u>s,f=l>s;if(d&&(u=t-u),f&&(l=t-l),u>s||l>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:u,k2neg:f,k2:l}}}},b),ve=BigInt(0),xe=e=>"bigint"==typeof e&&ve<e&&e<he,Be=e=>"bigint"==typeof e&&ve<e&&e<pe,Ae={};function Ie(e,...t){let n=Ae[e];if(void 0===n){const t=b(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=N(t,t),Ae[e]=n}return b(N(n,...t))}const Se=e=>e.toRawBytes(!0).slice(1),Ce=e=>T(e,32),ke=e=>z(e,he),Te=e=>z(e,pe),Oe=Ee.ProjectivePoint,Le=(e,t,n)=>Oe.BASE.multiplyAndAddUnsafe(e,t,n);function Ne(e){let t=Ee.utils.normPrivateKeyToScalar(e),n=Oe.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Te(-t),bytes:Se(n)}}function Ue(e){if(!xe(e))throw new Error("bad x: need 0 < x < p");const t=ke(e*e);let n=me(ke(t*e+BigInt(7)));n%ge!==ve&&(n=ke(-n));const r=new Oe(e,n,ye);return r.assertValidity(),r}function Re(...e){return Te(C(Ie("BIP0340/challenge",...e)))}function Pe(e){return Ne(e).bytes}function $e(e,t,n=f(32)){const r=L("message",e),{bytes:o,scalar:i}=Ne(t),s=L("auxRand",n,32),c=Ce(i^C(Ie("BIP0340/aux",s))),a=Ie("BIP0340/nonce",c,o,r),u=Te(C(a));if(u===ve)throw new Error("sign failed: k is zero");const{bytes:l,scalar:d}=Ne(u),h=Re(l,o,r),p=new Uint8Array(64);if(p.set(l,0),p.set(Ce(Te(d+h*i)),32),!He(p,r,o))throw new Error("sign: Invalid signature produced");return p}function He(e,t,n){const r=L("signature",e,64),o=L("message",t),i=L("publicKey",n,32);try{const e=Ue(C(i)),t=C(r.subarray(0,32));if(!xe(t))return!1;const n=C(r.subarray(32,64));if(!Be(n))return!1;const s=Re(Ce(t),Se(e),o),c=Le(e,n,Te(-s));return!(!c||!c.hasEvenY()||c.toAffine().x!==t)}catch(e){return!1}}const qe=(()=>({getPublicKey:Pe,sign:$e,verify:He,utils:{randomPrivateKey:Ee.utils.randomPrivateKey,lift_x:Ue,pointToBytes:Se,numberToBytesBE:T,bytesToNumberBE:C,taggedHash:Ie,mod:z}}))(),je=("object"==typeof globalThis&&"crypto"in globalThis&&globalThis.crypto,e=>e instanceof Uint8Array),_e=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Me=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const Fe=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Ve(e){if(!je(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Fe[e[n]];return t}function De(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,o=e.slice(r,r+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[t]=i}return n}function Ke(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!je(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class ze{clone(){return this._cloneInto()}}function We(e){const t=t=>e().update(Ke(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Ze(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ge(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const Ye={number:Ze,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:Ge,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Ze(e.outputLen),Ze(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){Ge(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class Je extends ze{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_e(this.buffer)}update(e){Ye.exists(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=Ke(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=_e(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ye.exists(this),Ye.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let e=i;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+u,c,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=_e(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=c/4,u=this.get();if(a>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<a;e++)s.setUint32(4*e,u[e],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const Qe=(e,t,n)=>e&t^e&n^t&n,Xe=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),et=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),tt=new Uint32Array(64);class nt extends Je{constructor(){super(64,32,8,!1),this.A=0|et[0],this.B=0|et[1],this.C=0|et[2],this.D=0|et[3],this.E=0|et[4],this.F=0|et[5],this.G=0|et[6],this.H=0|et[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:c}=this;return[e,t,n,r,o,i,s,c]}set(e,t,n,r,o,i,s,c){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|c}process(e,t){for(let n=0;n<16;n++,t+=4)tt[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=tt[e-15],n=tt[e-2],r=Me(t,7)^Me(t,18)^t>>>3,o=Me(n,17)^Me(n,19)^n>>>10;tt[e]=o+tt[e-7]+r+tt[e-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:c,G:a,H:u}=this;for(let e=0;e<64;e++){const t=u+(Me(s,6)^Me(s,11)^Me(s,25))+((l=s)&c^~l&a)+Xe[e]+tt[e]|0,d=(Me(n,2)^Me(n,13)^Me(n,22))+Qe(n,r,o)|0;u=a,a=c,c=s,s=i+t|0,i=o,o=r,r=n,n=t+d|0}var l;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,c=c+this.F|0,a=a+this.G|0,u=u+this.H|0,this.set(n,r,o,i,s,c,a,u)}roundClean(){tt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class rt extends nt{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ot=We((()=>new nt));We((()=>new rt));var it=Symbol("verified"),st=e=>e instanceof Object;new TextDecoder("utf-8");var ct=new TextEncoder;function at(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var ut=class{value;next=null;prev=null;constructor(e){this.value=e}},lt=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new ut(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function dt(e){return Ve(ot(ct.encode(function(e){if(!function(e){if(!st(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var ft=new class{generateSecretKey(){return qe.utils.randomPrivateKey()}getPublicKey(e){return Ve(qe.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Ve(qe.getPublicKey(t)),n.id=dt(n),n.sig=Ve(qe.sign(dt(n),t)),n[it]=!0,n}verifyEvent(e){if("boolean"==typeof e[it])return e[it];const t=dt(e);if(t!==e.id)return e[it]=!1,!1;try{const n=qe.verify(e.sig,t,e.pubkey);return e[it]=n,n}catch(t){return e[it]=!1,!1}}},ht=(ft.generateSecretKey,ft.getPublicKey,ft.finalizeEvent,ft.verifyEvent);function pt(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}async function yt(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}var gt,wt=e=>(e[it]=!0,!0),mt=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new lt;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=at(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new mt(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(e){return void t(e)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{t(e.message),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await yt();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}(e);if(t){const n=this.openSubs.get(t);if(!n)return;const r=function(e,t){let n=e.indexOf('"id":')+5,r=e.slice(n).indexOf('"')+n+1;return e.slice(r,r+64)}(e),o=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),o)return}try{let t=JSON.parse(e);switch(t[0]){case"EVENT":{const e=this.openSubs.get(t[1]),n=t[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(pt(e[n],t))return!0;return!1}(e.filters,n)&&e.onevent(n))}case"COUNT":{const e=t[1],n=t[2],r=this.openCountRequests.get(e);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(e)))}case"EOSE":{const e=this.openSubs.get(t[1]);if(!e)return;return void e.receivedEose()}case"OK":{const e=t[1],n=t[2],r=t[3],o=this.openEventPublishes.get(e);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(e)}case"CLOSED":{const e=t[1],n=this.openSubs.get(e);if(!n)return;return n.closed=!0,void n.close(t[2])}case"NOTICE":return void this.onnotice(t[1]);case"AUTH":return this.challenge=t[1],void this._onauth?.(t[1])}}catch(e){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(function(e,t){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}(this.url,this.challenge)),n=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new bt(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},bt=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}},Et=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=at(e);let n=this.relays.get(e);return n||(n=new mt(e,{verifyEvent:this.trustedRelayURLs.has(e)?wt:this.verifyEvent,websocketImplementation:this._WebSocket}),t?.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(at).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const n=new Set,r=[],o=Object.keys(e).length,i=[];let s=e=>{i[e]=!0,i.filter((e=>e)).length===o&&(t.oneose?.(),s=()=>{})};const c=[];let a=(e,n)=>{s(e),c[e]=n,c.filter((e=>e)).length===o&&(t.onclose?.(c),a=()=>{})};const u=e=>{if(t.alreadyHaveEvent?.(e))return!0;const r=n.has(e);return n.add(e),r},l=Promise.all(Object.entries(e).map((async(e,n,o)=>{if(o.indexOf(e)!==n)return void a(n,"duplicate url");let i,[c,l]=e;c=at(c);try{i=await this.ensureRelay(c,{connectionTimeout:t.maxWait?Math.max(.8*t.maxWait,t.maxWait-1e3):void 0})}catch(e){return void a(n,e?.message||String(e))}let d=i.subscribe(l,{...t,oneose:()=>s(n),onclose:e=>a(n,e),alreadyHaveEvent:u,eoseTimeout:t.maxWait});r.push(d)})));return{async close(){await l,r.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const o=[];this.subscribeManyEose(e,[t],{...n,onevent(e){o.push(e)},onclose(e){r(o)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(at).map((async(e,n,r)=>r.indexOf(e)!==n?Promise.reject("duplicate url"):(await this.ensureRelay(e)).publish(t)))}};try{gt=WebSocket}catch{}var vt=class extends Et{constructor(){super({verifyEvent:ht,websocketImplementation:gt})}};function xt(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Bt(...e){const t=(e,t)=>n=>e(t(n)),n=Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),r=e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0);return{encode:n,decode:r}}function At(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(xt(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function It(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function St(e,t="="){if(xt(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Ct(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function kt(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],i=Array.from(e);for(i.forEach((e=>{if(xt(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let o=r;o<i.length;o++){const c=i[o],a=t*e+c;if(!Number.isSafeInteger(a)||t*e/t!==e||a-c!=t*e)throw new Error("convertRadix: carry overflow");if(e=a%n,i[o]=Math.floor(a/n),!Number.isSafeInteger(i[o])||i[o]*n+e!==a)throw new Error("convertRadix: carry overflow");s&&(i[o]?s=!1:r=o)}if(o.push(e),s)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}const Tt=(e,t)=>t?Tt(t,e%t):e,Ot=(e,t)=>e+(t-Tt(e,t));function Lt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ot(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ot(t,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const r of e){if(xt(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(o=o<<t|r,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function Nt(e,t=!1){if(xt(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ot(8,e)>32||Ot(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Lt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Lt(n,e,8,t))}}}function Ut(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}Bt(Nt(4),At("0123456789ABCDEF"),It("")),Bt(Nt(5),At("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),St(5),It("")),Bt(Nt(5),At("0123456789ABCDEFGHIJKLMNOPQRSTUV"),St(5),It("")),Bt(Nt(5),At("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),It(""),Ct((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Bt(Nt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),St(6),It("")),Bt(Nt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),St(6),It(""));const Rt=e=>{return Bt((xt(t=58),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return kt(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(kt(e,t,256))}}),At(e),It(""));var t},Pt=(Rt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Rt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Rt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Bt(At("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),It(""))),$t=[996825010,642813549,513874426,1027748829,705979059];function Ht(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<$t.length;e++)1==(t>>e&1)&&(n^=$t[e]);return n}function qt(e,t,n=1){const r=e.length;let o=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);o=Ht(o)^n>>5}o=Ht(o);for(let t=0;t<r;t++)o=Ht(o)^31&e.charCodeAt(t);for(let e of t)o=Ht(o)^e;for(let e=0;e<6;e++)o=Ht(o);return o^=n,Pt.encode(Lt([o%2**30],30,5,!1))}function jt(e){const t="bech32"===e?1:734539939,n=Nt(5),r=n.decode,o=n.encode,i=Ut(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const c=Pt.decode(s).slice(0,-6),a=qt(i,c,t);if(!s.endsWith(a))throw new Error(`Invalid checksum in ${e}: expected "${a}"`);return{prefix:i,words:c}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=e.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${Pt.encode(n)}${qt(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:Ut(s),fromWords:r,fromWordsUnsafe:i,toWords:o}}const _t=jt("bech32");jt("bech32m");Bt(Nt(4),At("0123456789abcdef"),It(""),Ct((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));var Mt=new TextDecoder("utf-8"),Ft=(new TextEncoder,5e3);function Vt(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}function Dt(e){return zt("npub",De(e))}function Kt(e){return zt("note",De(e))}function zt(e,t){return function(e,t){let n=_t.toWords(t);return _t.encode(e,n,Ft)}(e,t)}var Wt=Symbol("verified"),Zt=e=>e instanceof Object;new TextDecoder("utf-8");var Gt=new TextEncoder;function Yt(e){return Ve(ot(Gt.encode(function(e){if(!function(e){if(!Zt(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var Jt=new class{generateSecretKey(){return qe.utils.randomPrivateKey()}getPublicKey(e){return Ve(qe.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Ve(qe.getPublicKey(t)),n.id=Yt(n),n.sig=Ve(qe.sign(Yt(n),t)),n[Wt]=!0,n}verifyEvent(e){if("boolean"==typeof e[Wt])return e[Wt];const t=Yt(e);if(t!==e.id)return e[Wt]=!1,!1;try{const n=qe.verify(e.sig,t,e.pubkey);return e[Wt]=n,n}catch(t){return e[Wt]=!1,!1}}},Qt=Jt.generateSecretKey,Xt=Jt.getPublicKey,en=Jt.finalizeEvent,tn=(Jt.verifyEvent,function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))});!function(){const e=["wss://relay-jp.nostr.wirednet.jp","wss://yabu.me","wss://r.kojira.io","wss://nrelay-jp.c-stellar.net","wss://nostr.holybea.com"],t=["wss://nostr-relay.nokotaro.com","wss://relay.nostr.wirednet.jp","wss://relay.damus.io","wss://nos.lol"],n=["wss://relay-jp.nostr.wirednet.jp","wss://yabu.me","wss://r.kojira.io","wss://nrelay-jp.c-stellar.net","wss://nostr.holybea.com"],r=[9801,9821],o=50,i="https://nostx.shino3.net/",s="http://localhost:9801",c="object"==typeof window,a=new Intl.DateTimeFormat("ja-jp",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),u=Qt();Xt(u);let l,d=[],f=[],h=[];if(c){function B(e){h=e[0],d=e[1],f=e[2];const t=document.getElementById("sstp-target"),n=document.getElementById("bottle-ifghost"),r=t.childElementCount;for(let e=0;e<r;e++)t.remove(0),n.remove(0);for(let e=0;e<d.length;e++){const r=document.createElement("option");r.setAttribute("value",d[e]),r.appendChild(document.createTextNode(d[e])),t.appendChild(r);const o=document.createElement("option");o.setAttribute("value",d[e]+","+f[e]),o.appendChild(document.createTextNode(d[e]+","+f[e])),n.appendChild(o)}document.getElementById("bottle-send").disabled=0==d.length}I(),document.getElementById("refresh").addEventListener("click",(function(){I()}));const A=document.getElementById("bottle-send");function I(){return tn(this,void 0,void 0,(function*(){const e=(yield g(s+"/api/sstp/v1",["EXECUTE SSTP/1.1","Charset: UTF-8","SecurityLevel: external","Command: GetFMO","",""].join("\n"))).split("\r\n"),t=[],n=[],r=[];for(let o=0;o<e.length;o++)if(e[o].indexOf(".hwnd"+String.fromCharCode(1))>=0){const n=e[o].split(String.fromCharCode(1))[1].replace("\r","");t.push(n)}else if(e[o].indexOf(".name"+String.fromCharCode(1))>=0){const t=e[o].split(String.fromCharCode(1))[1].replace("\r","");n.push(t)}else if(e[o].indexOf(".keroname"+String.fromCharCode(1))>=0){const t=e[o].split(String.fromCharCode(1))[1].replace("\r","");r.push(t)}B([t,n,r])}))}A.addEventListener("click",(function(e){return tn(this,void 0,void 0,(function*(){const e=document.getElementById("bottle-script");if(null==e)return;const t=e.value.replace(/\n/g,"");if(""==t)return;A.disabled=!0;const r={Script:t,IfGhost:document.getElementById("bottle-ifghost").value},o={kind:Number(document.getElementById("bottle-kind").value),pubkey:"",created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify(r)};let i;i=document.getElementById("use-nip-07").checked&&window.nostr?yield window.nostr.signEvent(o):en(o,u),w.publish(n,i),e.value="",A.disabled=!1}))})),document.querySelectorAll('.tabs > input[type="radio"]').forEach((t=>{t.addEventListener("change",(()=>{if(t.checked){const r=Number(document.getElementById("bottle-kind").value);"global"==t.id||"following"==t.id?(l.close(),l=v(e)):"bottle"==t.id&&(l.close(),l=x(n,r))}}))})),document.getElementById("bottle-kind").addEventListener("change",(()=>{const e=Number(document.getElementById("bottle-kind").value);l.close(),l=x(n,e)})),window.addEventListener("load",(()=>{const e=document.getElementById("use-nip-07"),t=document.getElementById("npub-nip-07"),n=document.getElementById("login-with-nip-07");window.nostr&&window.nostr.getPublicKey?(n.addEventListener("change",(e=>tn(this,void 0,void 0,(function*(){var e;const t=document.getElementById("pubkey");if(n.checked){const n=yield null===(e=window.nostr)||void 0===e?void 0:e.getPublicKey();void 0!==n&&(t.value=Dt(n),t.dispatchEvent(new Event("change")))}else t.value="",t.dispatchEvent(new Event("change"))})))),e.addEventListener("change",(()=>tn(this,void 0,void 0,(function*(){e.checked?yield function(){return tn(this,void 0,void 0,(function*(){var e;const n=yield null===(e=window.nostr)||void 0===e?void 0:e.getPublicKey();if(void 0!==n){t.value=Dt(n);const e={kinds:[0],authors:[n],limit:1},r=[];Array.from(document.getElementById("enabled-relay").options).forEach((e=>{r.push(e.value)})),Array.from(document.getElementById("following-relay").options).forEach((e=>{r.push(e.value)})),Array.from(document.getElementById("bottle-relay").options).forEach((e=>{r.push(e.value)}));const s=e=>{const t=JSON.parse(e.content),r=document.getElementById("bottle-profile-dt");if(r.innerHTML="",null!=t.picture){const e=document.createElement("img");e.src=t.picture,e.alt=t.name,e.width=o,e.height=o,r.appendChild(e)}r.appendChild(document.createTextNode(t.display_name));const s=document.createElement("a");s.setAttribute("href",i+Dt(e.pubkey)),s.textContent="@"+t.name,r.appendChild(s);const c=document.getElementById("bottle-profile-dd");c.innerHTML="",c.appendChild(document.createTextNode(t.about)),null!=t.picture&&document.querySelectorAll("#bottle-tl > dt").forEach((e=>{if(e.dataset.npub==Dt(n)){const n=document.createElement("img");n.src=t.picture,n.alt=t.name,n.width=o,n.height=o,e.appendChild(n)}}))},c=()=>{a.close()},a=w.subscribeMany(r,[e],{onevent:s,oneose:c})}}))}():(t.value="",document.getElementById("bottle-profile-dt").innerHTML="",document.getElementById("bottle-profile-dd").innerHTML="",document.querySelectorAll("#bottle-tl > dt > img").forEach((e=>{e.remove()})))}))))):(n.disabled=!0,e.disabled=!0,t.disabled=!0)}))}function p(e,t,n,r,o,i,s){return tn(this,void 0,void 0,(function*(){if(!document.getElementById("sstp-enable").checked)return;const c=document.getElementById("sstp-target").selectedIndex,a=h[c],u="\\0"+e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n")+"\\e";t?yield y([a,e.replace(/\n/g,"\\n"),t]):yield y([a,u,t,1,e.replace(/\n/g,"\\n"),n,r,o,i,s])}))}function y(e){return tn(this,void 0,void 0,(function*(){const t=e[0],n=e[1],r=e[2],o=["NOTIFY SSTP/1.1","Charset: UTF-8","SecurityLevel: external","Sender: angolmois","Event: OnNostr","Option: nobreak",`ReceiverGhostHWnd: ${t}`];r&&o.push(`IfGhost: ${r}`),o.push(`Script: ${n}`),o.push("Reference0: "+(r?"Nostr-Bottle/0.1":"Nostr/0.4"));for(let t=3;t<e.length;t++)o.push(`Reference${t-2}: ${e[t]}`);o.push(""),o.push("");const i=yield g(s+"/api/sstp/v1",o.join("\n"));return console.log(o.join("\n"),"\n----------\n",i,"\n----------\n"),i}))}function g(){return tn(this,arguments,void 0,(function*(e="",t=""){return(yield fetch(e,{method:"POST",headers:{"Content-Type":"text/plain"},body:t})).text()}))}const w=new vt;if(w.trackRelays=!0,l=v(e),c){!function(e,t,n,r){var o,i;const s=document.getElementById("enabled-relay");e.forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),t.appendChild(document.createTextNode(e)),null==s||s.appendChild(t)}));const c=document.getElementById("disabled-relay");t.forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),t.appendChild(document.createTextNode(e)),null==c||c.appendChild(t)}));const a=document.getElementById("bottle-relay");n.forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e),t.appendChild(document.createTextNode(e)),null==a||a.appendChild(t)}));const u=document.getElementById("bottle-kind");function d(e,t){const n=document.getElementById(e);if(!(n.selectedIndex>=0))return;const r=n.options[n.selectedIndex].value,o=document.getElementById(t),i=document.createElement("option");i.setAttribute("value",r),i.appendChild(document.createTextNode(r)),o.appendChild(i),n.remove(n.selectedIndex);const s=[];Array.from(document.getElementById("enabled-relay").options).forEach((e=>{s.push(e.value)})),l.close(),l=v(s)}r.forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e.toString()),t.appendChild(document.createTextNode(e.toString())),9801==e&&(t.selected=!0),null==u||u.appendChild(t)})),null===(o=document.getElementById("remove"))||void 0===o||o.addEventListener("click",(()=>d("enabled-relay","disabled-relay"))),null===(i=document.getElementById("add"))||void 0===i||i.addEventListener("click",(()=>d("disabled-relay","enabled-relay")))}(e,t,n,r);const S=document.getElementById("pubkey");let C;S.addEventListener("change",(()=>{const{type:e,data:t}=function(e){let{prefix:t,words:n}=_t.decode(e,Ft),r=new Uint8Array(_t.fromWords(n));switch(t){case"nprofile":{let e=Vt(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ve(e[0][0]),relays:e[1]?e[1].map((e=>Mt.decode(e))):[]}}}case"nevent":{let e=Vt(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ve(e[0][0]),relays:e[1]?e[1].map((e=>Mt.decode(e))):[],author:e[2]?.[0]?Ve(e[2][0]):void 0,kind:e[3]?.[0]?parseInt(Ve(e[3][0]),16):void 0}}}case"naddr":{let e=Vt(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Mt.decode(e[0][0]),pubkey:Ve(e[2][0]),kind:parseInt(Ve(e[3][0]),16),relays:e[1]?e[1].map((e=>Mt.decode(e))):[]}}}case"nrelay":{let e=Vt(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Mt.decode(e[0][0])}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Ve(r)};default:throw new Error(`unknown prefix ${t}`)}}(S.value);let n="";if("string"!=typeof t)return;n=t;const r={kinds:[3],authors:[n],limit:1},s=[];Array.from(document.getElementById("enabled-relay").options).forEach((e=>{s.push(e.value)})),Array.from(document.getElementById("following-relay").options).forEach((e=>{s.push(e.value)}));let c=!1;const a=w.subscribeMany(Array.from(new Set(s)),[r],{onevent:e=>tn(this,void 0,void 0,(function*(){if(c)return;let t;const r=[];try{t=JSON.parse(e.content)}catch(t){return console.log(t),void console.log(e)}c=!0;const s=[];e.tags.forEach((e=>{"p"==e[0]&&s.push(e[1])}));const a=document.getElementById("following-relay");Array.from(a.options).forEach((e=>{a.remove(0)})),Object.keys(t).forEach((e=>{r.push(e);const t=document.createElement("option");t.textContent=e,a.add(t)}));const u=r.map((e=>{try{w.ensureRelay(e)}catch(e){console.log("ensureRelay error: ",e)}})),l=(yield Promise.all(u),{kinds:[0],authors:[n],limit:1}),d=w.subscribeMany(r,[l],{onevent:e=>{const t=JSON.parse(e.content),n=document.getElementById("profile-dt");if(n.innerHTML="",null!=t.picture){const e=document.createElement("img");e.src=t.picture,e.alt=t.name,e.width=o,e.height=o,n.appendChild(e)}n.appendChild(document.createTextNode(t.display_name));const r=document.createElement("a");r.setAttribute("href",i+Dt(e.pubkey)),r.textContent="@"+t.name,n.appendChild(r);const s=document.getElementById("profile-dd");s.innerHTML="",s.appendChild(document.createTextNode(t.about))},oneose:()=>{d.close()}});s.push(n);const f={kinds:[1],authors:s,since:Math.floor(Date.now()/1e3)-1800,limit:20};document.getElementById("following-tl").innerHTML="";const h=w.subscribeMany(r,[f],{onevent:e=>{E("following",r,e)},oneose:()=>{}});C&&C.close(),C=h})),oneose:()=>{a.close()}})}))}const m={},b={};function E(e,t,n){const r={kinds:[0],authors:[n.pubkey]};let s=!1;const c=w.subscribeMany(t,[r],{onevent:t=>{var r,c,u,l;if(!n.id)return;if(s)return;s=!0;const d=JSON.parse(t.content),f=document.createElement("dt");if(null!=d.picture){const e=document.createElement("img");e.src=d.picture,e.alt=d.name,e.width=o,e.height=o,f.appendChild(e)}f.appendChild(document.createTextNode(d.display_name));const h=document.createElement("a");h.setAttribute("href",i+Dt(n.pubkey)),h.textContent="@"+d.name,f.appendChild(h);const y=document.createElement("time");y.textContent=a.format(new Date(1e3*n.created_at)),f.appendChild(y),f.setAttribute("id",e+"-"+Kt(n.id)),f.setAttribute("data-timestamp",n.created_at.toString());const g=document.createElement("dd");let E=!1,v=!1,x="";const B=[];n.tags.forEach((e=>{"e"==e[0]?(E=!0,x=e[1],B.push(Kt(e[1]))):"p"==e[0]&&(v=!0,B.push(Dt(e[1])))})),E&&null!=b[m[x]]?(g.appendChild(document.createTextNode("@"+b[m[x]])),g.appendChild(document.createElement("br"))):v&&null!=b[""]&&(g.appendChild(document.createTextNode("@"+b[""])),g.appendChild(document.createElement("br"))),n.content.split(/(#\[\d+\])/).forEach((e=>{const t=e.match(/#\[(\d+)\]/);if(t){const n=document.createElement("a");n.setAttribute("href","#"+Dt(B[Number(t[1])])),n.textContent=e,g.appendChild(n)}else g.appendChild(document.createTextNode(e))}));const A=document.createElement("button");A.textContent="Send SSTP",A.addEventListener("click",(function(e){var t,r,o;p(n.content,"",null!==(t=d.name)&&void 0!==t?t:"",null!==(r=d.display_name)&&void 0!==r?r:"",null!==(o=d.picture)&&void 0!==o?o:"",Kt(n.id),Dt(n.pubkey))})),f.appendChild(A);const I=document.createElement("button");I.textContent="この人でログインする",I.addEventListener("click",(function(e){document.getElementById("login-with-nip-07").checked=!1;const t=document.getElementById("pubkey");t.value=Dt(n.pubkey),t.dispatchEvent(new Event("change")),document.getElementById("following").checked=!0})),f.appendChild(I);const S=document.createElement("ul");S.className="relay";for(const e of null!==(r=w.seenOn.get(n.id))&&void 0!==r?r:[]){const t=document.createElement("li");t.textContent=e.url,S.appendChild(t)}g.appendChild(S);const C=document.getElementById(e+"-tl");if(d.name in b||(b[n.pubkey]=d.name),n.id in m||(m[n.id]=n.pubkey),document.getElementById(e+"-"+Kt(n.id)))return;const k=C.querySelectorAll("dt");let T=!1,O=!1;if(k.length>0){for(let e=0;e<k.length;e++)if(Number(k[e].dataset.timestamp)<n.created_at){C.insertBefore(g,k[e]),C.insertBefore(f,g),T=!0,0==e&&(O=!0);break}T||(C.appendChild(f),C.appendChild(g),T=!0)}else O=!0,C.prepend(g),C.prepend(f);document.getElementById(e).checked&&O&&p(n.content,"",null!==(c=d.name)&&void 0!==c?c:"",null!==(u=d.display_name)&&void 0!==u?u:"",null!==(l=d.picture)&&void 0!==l?l:"",Kt(n.id),Dt(n.pubkey))},oneose:()=>{c.close()}})}function v(e){const t={kinds:[1],since:Math.floor(Date.now()/1e3)-1800,limit:20};return c&&(document.getElementById("global-tl").innerHTML=""),w.subscribeMany(e,[t],{onevent:t=>{E("global",e,t)},oneose:()=>{}})}function x(e,t){const n={kinds:[t],limit:20};c&&(document.getElementById("bottle-tl").innerHTML="");const r=w.subscribeMany(e,[n],{onevent:e=>{!function(e,t){var n;if(!t.id)return;const r=JSON.parse(t.content),o=r.IfGhost,i=r.Script,s=document.createElement("dt");s.appendChild(document.createTextNode(o));const c=document.createElement("time");c.textContent=a.format(new Date(1e3*t.created_at)),s.appendChild(c),s.setAttribute("id",e+"-"+Kt(t.id)),s.setAttribute("data-timestamp",t.created_at.toString()),s.setAttribute("data-npub",Dt(t.pubkey)),Dt(t.pubkey)==document.getElementById("npub-nip-07").value&&document.querySelectorAll("#bottle-profile-dt > img").forEach((e=>{s.appendChild(e.cloneNode(!1))}));const u=document.createElement("dd"),l=document.createElement("button");l.textContent="Send SSTP",l.addEventListener("click",(function(e){p(i,o)})),s.appendChild(l),u.appendChild(document.createTextNode(i));const d=document.createElement("ul");d.className="relay";for(const e of null!==(n=w.seenOn.get(t.id))&&void 0!==n?n:[]){const t=document.createElement("li");t.textContent=e.url,d.appendChild(t)}u.appendChild(d);const f=document.getElementById(e+"-tl");if(document.getElementById(e+"-"+Kt(t.id)))return;const h=f.querySelectorAll("dt");let y=!1,g=!1;if(h.length>0){for(let e=0;e<h.length;e++)if(Number(h[e].dataset.timestamp)<t.created_at){f.insertBefore(u,h[e]),f.insertBefore(s,u),y=!0,0==e&&(g=!0);break}y||(f.appendChild(s),f.appendChild(u),y=!0)}else g=!0,f.prepend(u),f.prepend(s);document.getElementById(e).checked&&g&&p(i,o)}("bottle",e)},oneose:()=>{}});return r}}()})();